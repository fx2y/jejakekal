---
description: UI shell/state/e2e behavior contracts.
paths:
  - apps/ui/src/**
  - apps/ui/test/**
---

# UI Rules

- Preserve 3-plane contract and IDs: `conversation-plane`, `execution-plane`, `artifact-plane`.
- Drive state via explicit finite states on `#run-status[data-state]`: `idle|running|done|error`.
- UI triggers workflow through canonical `/runs` + `/runs/:id` + `/runs/:id/export`; do not invent side channels.
- Render execution/artifact lists from API payload, not derived guesswork.
- Keep selectors and IDs stable; tests depend on them as product-surface contracts.
- E2E assertions target behavior/state transitions/counts/IDs; never screenshot/pixel coupling.
- Styling can evolve, but must keep desktop/mobile operable and accessible semantics intact.

# Failure Recipes

- E2E cannot find plane: ID drift broke contract; restore IDs or update tests with migration intent.
- Status stuck running: check fetch error path updates `data-state=error` and visible text.
- Artifact count regression: inspect `/runs/:id/export` artifact mapping and run-bundle generation.
