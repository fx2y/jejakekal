---
description: UI shell/state/e2e behavior contracts.
paths:
  - apps/ui/src/**
  - apps/ui/test/**
---

# UI Rules

- Preserve 3-plane IDs as product API: `conversation-plane`,`execution-plane`,`artifact-plane`.
- Additive aliases `#conv/#artifacts/#exec` are allowed, but only as wrappers around frozen plane IDs.
- FSM contract is strict: `#run-status[data-state]` in `idle|running|done|error` only.
- Client flow keeps `/runs -> /runs/:id poll` and may add `/artifacts*` surfaces additively; no side channels.
- Render from API payload; avoid client-side inferred state not present in contract.
- HX history-restore must render full documents (`HX-History-Restore-Request` => full page).
- Polling uses adaptive timeout/backoff and must remain configurable (`pollTimeoutMs`,`pollIntervalMs`,`pollMaxIntervalMs`).
- Unknown backend status is terminal error path, not infinite running spinner.
- E2E validates IDs/transitions/counts/contracts; no pixel/screenshot assertions.
- UI server/tests must use ephemeral ports by default to avoid ambient process collisions.
- Visual/style changes are free if semantics, accessibility, desktop/mobile operability, and test contracts stay intact.

# Failure Recipes

- E2E cannot find plane/state node: ID drift; restore contract or ship explicit migration.
- HX nav/back breaks: check full-vs-fragment branching and history-restore handling.
- Status stuck `running`: verify poll timeout/unknown-status handling sets terminal error state.
- Artifact regressions: inspect `/runs/:id/export` mapping and run-bundle generation contract.
